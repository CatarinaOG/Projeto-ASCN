---

- name: Refresh inventory
  meta: refresh_inventory

- name: Check that you can connect (GET) to Ghost and it returns a status 200
  ansible.builtin.uri:
    url: "http://{{ ghost_ip }}:{{ghost_port}}/"
    method: GET
    status_code: 200
  register: result
  until: result.status == 200
  retries: 3
  delay: 5

- name: Login to the portal
  uri:
    url: "http://{{ ghost_ip }}:{{ ghost_port }}/ghost"
    method: POST
    body: "username=jpdelgado2001@gmail.com&password=123456"
    status_code: 200
    follow_redirects: true
  register: login

- name: Get cookie
  ansible.builtin.uri:
    url: "http://{{ ghost_ip }}:{{ ghost_port }}/ghost/api/admin/session/"
    method: GET
  register: result
  until: result.status == 200
  retries: 1
  delay: 3